(()=>{"use strict";const t=async({url:t,method:e,data:s})=>{try{const a={GET:{method:"GET"},POST:{method:"POST",body:JSON.stringify(s),headers:{"Content-Type":"application/json"}},DELETE:{method:"DELETE"},PUT:{method:"PUT",body:JSON.stringify(s),headers:{"Content-Type":"application/json"}}},o=await fetch(t,{...a[e]});if(!o.ok)throw o;return{ok:!0,data:await o.json()}}catch(t){const e=`status: ${t.status}${t.statusText?`, statusText: ${t.statusText}`:""}`;return console.error(e),{ok:!1}}};class e{constructor(){this.send=t}getUsers(){return this.send({url:"http://localhost:4545/users"}).then((t=>t))}async getUser(t){let{ok:e,data:s}=await this.getUsers();return s=e?s.filter((e=>e.login===t))[0]:{},{ok:e,data:s}}}const s=async function(t,s){const a=new e,o={};let r;async function n(t,e,s,o){let n,c="";switch(t){case"isRequired":n=async()=>(c=s.message,""===e.trim());break;case"isExist":n=async()=>{const t=await a.getUser(e);return t.ok?(r=t.data,c=s.message.error,void 0===t.data):(c=s.message.serverError,!1)};break;case"isPasswordTrue":n=async()=>r?(c=s.message,r.password!==e):(c="",!0)}if(await n())return c}async function c(e){for(const a of Object.keys(s[e])){const r=await n(a,t[e],s[e][a]);r&&!o[e]&&(o[e]=r)}}return await async function(){for(const e of Object.keys(t))await c(e);return o}()};(async()=>{const t={login:{isRequired:{message:"Логин обязателен для заполнения"}},password:{isRequired:{message:"Пароль обязателен для заполнения"}}},e={login:{isExist:{message:{serverError:"Ошибка соединения с сервером",error:"Данное имя не зарегистрировано"}}},password:{isPasswordTrue:{message:"Не верный пароль"}}},a=(t,e)=>{t.querySelectorAll(".text-warning").forEach((t=>{const{name:s}=t.dataset;t.textContent=e[s]||""}))};document.querySelector(".main-form form").addEventListener("submit",(async o=>{o.preventDefault();const r=o.target.closest("form");let n=new FormData(r);const c={};n.forEach(((t,e)=>{c[e]=t}));const i=await s(c,t);if(0===Object.keys(i).length){const t=await s(c,e);0===Object.keys(t).length?(a(r,t),document.cookie="isAuthorized=true",window.location.replace("./table.html"),console.log("sendForm")):a(r,t)}else a(r,i)}))})()})();